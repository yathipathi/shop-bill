<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SREE LAXMI OFFSET PRINTERS - Printing Order Calculator</title>

<style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f4f4f4; }
    h1 { text-align:center; margin-bottom:5px; font-size:26px; font-weight:bold; color:#222; }
    h2 { text-align:center; margin-top:0; font-size:16px; color:#555; }
    .container { max-width:1100px; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    fieldset { border:1px solid #ccc; padding:10px; margin-bottom:12px; border-radius:8px; }
    legend { font-weight:bold; }
    input,select { padding:6px; width:100%; max-width:260px; box-sizing:border-box; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { border:1px solid #ddd; padding:6px; text-align:center; }
    th { background:#eaeaea; }
    .amount-display { background:#eaffd8; font-weight:bold; }
    button { padding:7px 13px; border:none; border-radius:5px; margin:3px; cursor:pointer; font-weight:bold; }
    .save-btn { background:#4CAF50; color:white; }
    .clear-btn { background:red; color:white; }
    .wa-btn { background:#25D366; color:white; }
    .delete-btn { background:#ff4757; color:white; }
    .edit-btn { background:#ffa502; color:white; }
    .total-box { text-align:right; font-size:20px; margin-top:15px; font-weight:bold; background:#e6ffe6; padding:12px; border-radius:6px; }
</style>
</head>
<body>

<div class="container">

<h1>ðŸ’  SREE LAXMI OFFSET PRINTERS ðŸ’ </h1>
<h2>Order Billing & Calculation System</h2>
<br>

<label><b>Customer Name:</b></label>
<input type="text" id="customerName">

<br><br>

<label><b>Customer WhatsApp Number:</b></label>
<input type="text" id="customerWhatsapp" placeholder="Ex: 8341065537 or +918341065537">

<br><br>

<label><b>Date:</b></label>
<input type="text" id="billDate" readonly>

<br><br>

<!-- ================= Sections ================= -->

<fieldset>
  <legend>Namuna Ballot</legend>
  <select id="namunaCopies">
    <option value="0">Select</option>
    <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
    <option>600</option><option>700</option><option>800</option><option>900</option><option>1000</option>
    <option>1100</option><option>1200</option><option>1300</option><option>1400</option><option>1500</option>
    <option>1600</option><option>1700</option><option>1800</option><option>1900</option><option>2000</option>
  </select>
  <input type="text" id="namunaAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Namuna Ballot 4 & 5</legend>
  <select id="namuna45Copies">
    <option value="0">Select</option>
    <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
    <option>600</option><option>700</option><option>800</option><option>900</option><option>1000</option>
    <option>1100</option><option>1200</option><option>1300</option><option>1400</option><option>1500</option>
    <option>1600</option><option>1700</option><option>1800</option><option>1900</option><option>2000</option>
  </select>
  <input type="text" id="namuna45Amount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Namuna Ballot 9 Symbols</legend>
  <select id="namuna9Copies">
    <option value="0">Select</option>
    <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
    <option>600</option><option>700</option><option>800</option><option>900</option><option>1000</option>
    <option>1100</option><option>1200</option><option>1300</option><option>1400</option><option>1500</option>
    <option>1600</option><option>1700</option><option>1800</option><option>1900</option><option>2000</option>
  </select>
  <input type="text" id="namuna9Amount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Handslips</legend>
  <select id="handslipCopies">
    <option value="0">Select</option>
    <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
    <option>600</option><option>700</option><option>800</option><option>900</option><option>1000</option>
    <option>1100</option><option>1200</option><option>1300</option><option>1400</option><option>1500</option>
    <option>1600</option><option>1700</option><option>1800</option><option>1900</option><option>2000</option>
  </select>
  <input type="text" id="handslipAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Posters</legend>
  <select id="posterCopies">
    <option value="0">Select</option>
    <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
    <option>600</option><option>700</option><option>800</option><option>900</option><option>1000</option>
    <option>1100</option><option>1200</option><option>1300</option><option>1400</option><option>1500</option>
    <option>1600</option><option>1700</option><option>1800</option><option>1900</option><option>2000</option>
  </select>
  <input type="text" id="posterAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Mixed Posters</legend>
  <select id="mixedPosterCopies">
    <option value="0">Select</option>
    <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
    <option>600</option><option>700</option><option>800</option><option>900</option><option>1000</option>
    <option>1100</option><option>1200</option><option>1300</option><option>1400</option><option>1500</option>
    <option>1600</option><option>1700</option><option>1800</option><option>1900</option><option>2000</option>
  </select>
  <input type="text" id="mixedPosterAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Mixed Stickers (â‚¹70 Each)</legend>
  <input type="number" id="mixedStickerCopies" placeholder="Enter quantity">
  <input type="text" id="mixedStickerAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Stickers (â‚¹50 Each)</legend>
  <input type="number" id="stickerCopies" placeholder="Enter quantity">
  <input type="text" id="stickerAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Kanduvulu (â‚¹15 Each)</legend>
  <input type="number" id="kanduvalCopies" placeholder="Enter quantity">
  <input type="text" id="kanduvalAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Jenda (â‚¹20 Each)</legend>
  <input type="number" id="jendaCopies" placeholder="Enter quantity">
  <input type="text" id="jendaAmount" readonly class="amount-display">
</fieldset>

<fieldset>
  <legend>Badges (â‚¹5 Each)</legend>
  <input type="number" id="badgeCopies" placeholder="Enter quantity">
  <input type="text" id="badgeAmount" readonly class="amount-display">
</fieldset>

<!-- ================= TOTAL ================= -->

<div class="total-box">
  Total Amount: â‚¹ <span id="grandTotal">0</span>
</div>

<!-- BUTTONS -->

<button class="clear-btn" onclick="clearForm()">Clear</button>
<button class="save-btn" onclick="saveEntry()">Save</button>
<button class="wa-btn" onclick="sendWhatsApp()">Send WhatsApp Bill</button>

<br><br>

<h2>ðŸ“Œ Saved Bills - SREE LAXMI OFFSET PRINTERS</h2>

<table>
<thead>
<tr>
  <th>S.No</th>
  <th>Name</th>
  <th>Date</th>
  <th>Original Amount</th>
  <th>Edited Amount</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="savedTable"></tbody>
</table>

<!-- ðŸ”¢ TALLY TOTALS OF ORIGINAL & EDITED AMOUNTS -->
<div class="total-box" style="font-size:16px; text-align:left;">
  Total Original Amount: â‚¹ <span id="totalOriginal">0</span> &nbsp;&nbsp;|&nbsp;&nbsp;
  Total Edited Amount: â‚¹ <span id="totalEdited">0</span>
</div>

</div>

<script>
let count = 0;
let savedBills = [];
let nextId = 1;

// Poster base prices (100â€“1000)
const posterPrice = {
  0:0, 100:450, 200:700, 300:800, 400:1000,
  500:1200, 600:1400, 700:1600, 800:1800, 900:2000, 1000:2200
};

// ===== PRICE HELPERS =====
function getNamunaPrice(copies) {
  const c = parseInt(copies) || 0;
  if (c <= 0) return 0;
  if (c > 2000) return 2250;  // 250 + 2000
  return 250 + c;
}

function getNamuna9Price(copies) {
  const c = parseInt(copies) || 0;
  if (c <= 0) return 0;
  if (c > 2000) return 2300;  // 300 + 2000
  return 300 + c;
}

function getPosterPrice(copies) {
  let c = parseInt(copies) || 0;
  if (c <= 0) return 0;
  if (c > 2000) c = 2000;

  if (c <= 1000) return posterPrice[c] || 0;

  const extraSteps = (c - 1000) / 100;
  return 2200 + extraSteps * 200;
}

function getMixedPosterPrice(copies) {
  let c = parseInt(copies) || 0;
  if (c <= 0) return 0;
  if (c > 2000) c = 2000;
  return c * 4;
}

function getMixedStickerAmount(qty) {
  const q = parseInt(qty) || 0;
  return q * 70;
}

function updateTotals() {
  const namunaCopies      = document.getElementById('namunaCopies').value || "0";
  const namuna45Copies    = document.getElementById('namuna45Copies').value || "0";
  const namuna9Copies     = document.getElementById('namuna9Copies').value || "0";
  const handslipCopies    = document.getElementById('handslipCopies').value || "0";
  const posterCopies      = document.getElementById('posterCopies').value || "0";
  const mixedPosterCopies = document.getElementById('mixedPosterCopies').value || "0";
  const mixedStickerQty   = document.getElementById('mixedStickerCopies').value || "0";
  const stickerQty        = parseInt(document.getElementById('stickerCopies').value || 0);
  const kanduvalQty       = parseInt(document.getElementById('kanduvalCopies').value || 0);
  const jendaQty          = parseInt(document.getElementById('jendaCopies').value || 0);
  const badgeQty          = parseInt(document.getElementById('badgeCopies').value || 0);

  const n   = getNamunaPrice(namunaCopies);
  const n45 = getNamunaPrice(namuna45Copies);
  const n9  = getNamuna9Price(namuna9Copies);
  const h   = getNamunaPrice(handslipCopies);
  const p   = getPosterPrice(posterCopies);
  const mp  = getMixedPosterPrice(mixedPosterCopies);
  const ms  = getMixedStickerAmount(mixedStickerQty);
  const s   = stickerQty * 50;
  const k   = kanduvalQty * 15;
  const j   = jendaQty * 20;
  const b   = badgeQty * 5;

  document.getElementById('namunaAmount').value        = n   || "";
  document.getElementById('namuna45Amount').value      = n45 || "";
  document.getElementById('namuna9Amount').value       = n9  || "";
  document.getElementById('handslipAmount').value      = h   || "";
  document.getElementById('posterAmount').value        = p   || "";
  document.getElementById('mixedPosterAmount').value   = mp  || "";
  document.getElementById('mixedStickerAmount').value  = ms  || "";
  document.getElementById('stickerAmount').value       = s   || "";
  document.getElementById('kanduvalAmount').value      = k   || "";
  document.getElementById('jendaAmount').value         = j   || "";
  document.getElementById('badgeAmount').value         = b   || "";

  document.getElementById('grandTotal').textContent =
    n + n45 + n9 + h + p + mp + ms + s + k + j + b;
}

// INPUT EVENTS
document.querySelectorAll("input").forEach(el => {
  el.addEventListener("input", updateTotals);
});
document.querySelectorAll("select").forEach(el => {
  el.addEventListener("change", updateTotals);
});

function clearForm() {
  document.querySelectorAll("input,select").forEach(el => {
    if (el.id === 'billDate') return;
    if (el.tagName.toLowerCase() === 'select') el.value = "0";
    else el.value = "";
  });
  document.getElementById('grandTotal').textContent = "0";
  document.getElementById("billDate").value = new Date().toLocaleDateString("en-IN");
}

// LOAD SAVED BILLS
function loadSavedBills() {
  try {
    const stored = localStorage.getItem('slp_savedBills');
    const storedNextId = localStorage.getItem('slp_nextId');

    if (stored) {
      const parsed = JSON.parse(stored);
      if (Array.isArray(parsed)) {
        savedBills = parsed.map(bill => {
          if (bill.originalTotal === undefined && bill.editedTotal === undefined) {
            return {
              id: bill.id,
              name: bill.name,
              date: bill.date || "-",
              originalTotal: bill.total || 0,
              editedTotal: null
            };
          }
          return {
            id: bill.id,
            name: bill.name,
            date: bill.date || "-",
            originalTotal: bill.originalTotal || 0,
            editedTotal: (bill.editedTotal === undefined ? null : bill.editedTotal)
          };
        });
      }
    }

    if (storedNextId) {
      nextId = parseInt(storedNextId) || 1;
    } else {
      const maxId = savedBills.reduce((max, b) => Math.max(max, b.id || 0), 0);
      nextId = maxId + 1;
    }

    renderSavedBills();
  } catch (e) {
    console.error("Error loading saved bills:", e);
    savedBills = [];
    nextId = 1;
  }
}

function saveBillsToStorage() {
  try {
    localStorage.setItem('slp_savedBills', JSON.stringify(savedBills));
    localStorage.setItem('slp_nextId', String(nextId));
  } catch (e) {
    console.error("Error saving bills:", e);
  }
}

// RENDER SAVED BILLS
function renderSavedBills() {
  const tbody = document.getElementById('savedTable');
  tbody.innerHTML = "";

  let totalOriginal = 0;
  let totalEdited = 0;

  savedBills.forEach((bill, index) => {
    const tr = document.createElement('tr');
    tr.setAttribute('data-id', bill.id);

    const editedText = (bill.editedTotal !== null && bill.editedTotal !== undefined)
      ? `â‚¹${bill.editedTotal}`
      : "-";

    totalOriginal += bill.originalTotal || 0;
    if (bill.editedTotal !== null && bill.editedTotal !== undefined) {
      totalEdited += bill.editedTotal;
    }

    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${bill.name}</td>
      <td>${bill.date || "-"}</td>
      <td>â‚¹${bill.originalTotal}</td>
      <td>${editedText}</td>
      <td>
        <button class="edit-btn" onclick="editBill(this)">Edit</button>
        <button class="delete-btn" onclick="deleteRow(this)">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  const totalOriginalEl = document.getElementById('totalOriginal');
  const totalEditedEl = document.getElementById('totalEdited');
  if (totalOriginalEl) totalOriginalEl.textContent = totalOriginal;
  if (totalEditedEl) totalEditedEl.textContent = totalEdited;
}

function editBill(btn) {
  const tr = btn.closest('tr');
  const id = parseInt(tr.getAttribute('data-id'));

  const bill = savedBills.find(b => b.id === id);
  if (!bill) return;

  const currentAmount = (bill.editedTotal !== null && bill.editedTotal !== undefined)
    ? bill.editedTotal
    : bill.originalTotal;

  const newAmountStr = prompt(`Enter new edited amount for "${bill.name}"`, currentAmount);
  if (newAmountStr === null) return;

  const newAmount = parseInt(newAmountStr);
  if (isNaN(newAmount) || newAmount < 0) {
    alert("Please enter a valid amount.");
    return;
  }

  bill.editedTotal = newAmount;
  saveBillsToStorage();
  renderSavedBills();
}

function deleteRow(btn) {
  const tr = btn.closest('tr');
  const id = parseInt(tr.getAttribute('data-id'));
  savedBills = savedBills.filter(bill => bill.id !== id);
  saveBillsToStorage();
  renderSavedBills();
}

function saveEntry() {
  updateTotals();
  const total = parseInt(document.getElementById('grandTotal').textContent || "0");
  const name  = document.getElementById('customerName').value || "-";
  const date  = document.getElementById('billDate').value || new Date().toLocaleDateString("en-IN");

  if (total === 0) {
    alert("No amount to save.");
    return;
  }

  const newBill = {
    id: nextId++,
    name: name,
    date: date,
    originalTotal: total,
    editedTotal: null
  };

  savedBills.push(newBill);
  saveBillsToStorage();
  renderSavedBills();
  clearForm();
}

// ===== NORMALISE WHATSAPP NUMBER =====
function normalizeWhatsAppNumber(input) {
  let digits = (input || "").replace(/\D/g, ""); // keep only numbers

  if (!digits) return null;

  // remove leading 00 if present (international format)
  if (digits.startsWith("00")) {
    digits = digits.slice(2);
  }

  // Indian mobile typed as 10 digits
  if (digits.length === 10) {
    return "91" + digits;
  }

  // Indian mobile typed as 0XXXXXXXXXX (11 digits)
  if (digits.length === 11 && digits.startsWith("0")) {
    return "91" + digits.slice(1);
  }

  // Already has country code, 11â€“15 digits, not starting with 0
  if (digits.length >= 11 && digits.length <= 15 && !digits.startsWith("0")) {
    return digits;
  }

  // Anything else is suspicious
  return null;
}

// SEND WHATSAPP BILL
function sendWhatsApp() {
  updateTotals();

  const name = document.getElementById('customerName').value || "-";
  const rawNum = document.getElementById('customerWhatsapp').value;
  const date = document.getElementById('billDate').value || new Date().toLocaleDateString("en-IN");

  const num = normalizeWhatsAppNumber(rawNum);
  if (!num) {
    alert("Please enter a valid WhatsApp number.\nExamples:\n8341065537\n+918341065537");
    return;
  }

  const totalForSave = parseInt(document.getElementById('grandTotal').textContent || "0");
  if (totalForSave > 0) {
    const newBill = {
      id: nextId++,
      name: name,
      date: date,
      originalTotal: totalForSave,
      editedTotal: null
    };
    savedBills.push(newBill);
    saveBillsToStorage();
    renderSavedBills();
  }

  const lines = [];

  const addLineIfAny = (label, copiesId, amountId, unit) => {
    const qty = document.getElementById(copiesId).value || "0";
    const amt = parseInt(document.getElementById(amountId).value || "0");
    if (parseInt(qty) > 0 && amt > 0) {
      lines.push(`${label}: ${qty} ${unit} â€“ â‚¹${amt}`);
    }
  };

  addLineIfAny("Namuna Ballot", "namunaCopies", "namunaAmount", "copies");
  addLineIfAny("Namuna Ballot 4 & 5", "namuna45Copies", "namuna45Amount", "copies");
  addLineIfAny("Namuna Ballot 9 Symbols", "namuna9Copies", "namuna9Amount", "copies");
  addLineIfAny("Handslips", "handslipCopies", "handslipAmount", "copies");
  addLineIfAny("Posters", "posterCopies", "posterAmount", "copies");
  addLineIfAny("Mixed Posters", "mixedPosterCopies", "mixedPosterAmount", "copies");
  addLineIfAny("Mixed Stickers", "mixedStickerCopies", "mixedStickerAmount", "pcs");
  addLineIfAny("Stickers", "stickerCopies", "stickerAmount", "pcs");
  addLineIfAny("Kanduvulu", "kanduvalCopies", "kanduvalAmount", "pcs");
  addLineIfAny("Jenda", "jendaCopies", "jendaAmount", "pcs");
  addLineIfAny("Badges", "badgeCopies", "badgeAmount", "pcs");

  if (lines.length === 0) {
    alert("Please select at least one item before sending the WhatsApp bill.");
    return;
  }

  const itemsText = lines.join('\n');

  const msg =
` *SREE LAXMI OFFSET PRINTERS* 

 Customer: ${name}
 Date: ${date}

${itemsText}

 *Total: â‚¹${document.getElementById('grandTotal').textContent}*



 As the elections approach, may victory walk beside you.  Best wishes - *Sree Lakshmi Printing Press HUZURABAD* ðŸ‡®ðŸ‡³

 à°œà°°à°—à°¬à±‹à°¯à±‡ à°ˆ à°Žà°¨à±à°¨à°¿à°•à°²à±à°²à±‹ à°®à±€à°°à± à°µà°¿à°œà°¯à°‚ à°¸à°¾à°§à°¿à°‚à°šà°¾à°²à°¨à°¿  à°¶à±à°°à±€ à°²à°•à±à°·à±à°®à±€ à°ªà±à°°à°¿à°‚à°Ÿà°¿à°‚à°—à± à°ªà±à°°à±†à°¸à± à°®à°¨à°¸à±à°«à±‚à°°à±à°¤à°¿à°—à°¾ à°•à±‹à°°à±à°•à±à°‚à°Ÿà±à°‚à°¦à°¿

CONTACT:8341065537

â€ Thank You `;

  const encodedText = encodeURIComponent(msg);
  const url = `https://wa.me/${num}?text=${encodedText}`;
  window.open(url, "_blank");
}

// ON LOAD
window.addEventListener('load', () => {
  loadSavedBills();
  const dateInput = document.getElementById("billDate");
  if (dateInput) {
    dateInput.value = new Date().toLocaleDateString("en-IN");
  }
});
</script>

</body>
</html>
